---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.18.0
  name: releases.iac.facets.cloud
spec:
  group: iac.facets.cloud
  names:
    kind: Release
    listKind: ReleaseList
    plural: releases
    singular: release
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.phase
      name: Phase
      type: string
    - jsonPath: .spec.environment.id
      name: Environment
      type: string
    - jsonPath: .status.currentPhase
      name: Current-Phase
      type: string
    - jsonPath: .status.approvalPhase
      name: Approval-Phase
      type: string
    - jsonPath: .status.queuePosition
      name: Queue-Pos
      type: integer
    - jsonPath: .status.environmentLocked
      name: Locked
      type: boolean
    - jsonPath: .status.approvalRequired
      name: Approval-Req
      type: boolean
    - jsonPath: .status.duration
      name: Duration
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1
    schema:
      openAPIV3Schema:
        description: Release is the Schema for the releases API.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: ReleaseSpec defines the desired state of Release.
            properties:
              artifactories:
                description: Artifactories defines container registry configurations
                items:
                  description: Artifactory defines a container registry
                  properties:
                    artifactoryType:
                      description: ArtifactoryType specifies the type
                      enum:
                      - ECR
                      - ACR
                      - GCR
                      - DOCKERHUB
                      - OTHERS
                      type: string
                    awsAccountId:
                      type: string
                    awsKey:
                      description: AWS specific fields
                      type: string
                    awsRegion:
                      type: string
                    awsSecret:
                      type: string
                    name:
                      description: Name of the artifactory
                      type: string
                    password:
                      description: Password for authentication
                      type: string
                    uri:
                      description: URI of the artifactory
                      type: string
                    username:
                      description: Username for authentication
                      type: string
                  required:
                  - artifactoryType
                  - name
                  - uri
                  type: object
                type: array
              blueprintAttributes:
                description: BlueprintAttributes contains blueprint-specific configuration
                properties:
                  artifacts:
                    additionalProperties:
                      description: Artifact defines a container artifact
                      properties:
                        buildID:
                          description: BuildID for tracking
                          type: string
                        uri:
                          description: URI of the artifact
                          type: string
                      required:
                      - uri
                      type: object
                    description: Artifacts defines artifact references
                    type: object
                  secretRef:
                    description: SecretRef references a secret containing sensitive
                      data
                    properties:
                      cloud:
                        description: Cloud provider
                        enum:
                        - aws
                        - azure
                        - gcp
                        type: string
                      key:
                        description: Key or ARN of the secret
                        type: string
                    required:
                    - cloud
                    - key
                    type: object
                  variables:
                    additionalProperties:
                      type: string
                    description: Variables defines blueprint variables
                    type: object
                required:
                - artifacts
                - secretRef
                - variables
                type: object
              cluster:
                description: Cluster contains cluster configuration
                properties:
                  azs:
                    description: AZs is the list of availability zones
                    items:
                      type: string
                    type: array
                  machineType:
                    description: MachineType is the instance/machine type
                    type: string
                  name:
                    description: Name is the name of the cluster
                    type: string
                  project:
                    description: Project is the cloud project/account identifier
                    type: string
                  region:
                    description: Region is the cloud region
                    type: string
                  vpcCIDR:
                    description: VpcCIDR is the VPC CIDR block
                    type: string
                type: object
              environment:
                description: Environment identifies the target environment
                properties:
                  cloud:
                    description: Cloud specifies the cloud provider
                    enum:
                    - AWS
                    - AZURE
                    - GCP
                    - KUBERNETES
                    type: string
                  commonEnvironmentVariables:
                    additionalProperties:
                      type: string
                    description: CommonEnvironmentVariables contains environment-wide
                      variables
                    type: object
                  id:
                    description: ID is the unique identifier for the environment
                    type: string
                  name:
                    description: Name of the environment
                    type: string
                  region:
                    description: Region is the cloud region
                    type: string
                required:
                - id
                - name
                type: object
              logLevelOverride:
                description: LogLevelOverride overrides the default log level
                enum:
                - debug
                - info
                - warn
                - error
                type: string
              modules:
                description: Modules defines the terraform modules to apply
                items:
                  description: Module defines a terraform module
                  properties:
                    moduleMetadata:
                      description: ModuleMetadata contains module metadata
                      properties:
                        always_use_state_reference:
                          description: AlwaysUseStateReference forces the use of state
                            references
                          type: boolean
                        clouds:
                          description: Clouds supported by this module
                          items:
                            type: string
                          type: array
                        description:
                          description: Description of the module
                          type: string
                        flavor:
                          description: Flavor of the module
                          type: string
                        inputs:
                          description: Inputs schema for the module
                          type: object
                          x-kubernetes-preserve-unknown-fields: true
                        intent:
                          description: Intent of the module
                          type: string
                        outputs:
                          description: Outputs schema for the module
                          type: object
                          x-kubernetes-preserve-unknown-fields: true
                        version:
                          description: Version of the module
                          type: string
                      required:
                      - clouds
                      - flavor
                      - intent
                      - version
                      type: object
                    name:
                      description: Name of the module
                      type: string
                    resources:
                      description: Resources to create with this module
                      items:
                        description: Resource defines a resource to be created
                        properties:
                          name:
                            description: Name of the resource
                            type: string
                          resourceMetadata:
                            description: ResourceMetadata contains resource metadata
                            properties:
                              commitId:
                                description: CommitId references the commit that created/updated
                                  this resource
                                type: string
                              overrideVersion:
                                description: OverrideVersion is the override version
                                  number
                                type: string
                              overrideVersionId:
                                description: OverrideVersionId is the unique identifier
                                  for this override version
                                type: string
                              resourceName:
                                description: ResourceName is the name of the resource
                                type: string
                              resourceType:
                                description: ResourceType identifies the type of resource
                                type: string
                            required:
                            - commitId
                            - overrideVersion
                            - overrideVersionId
                            - resourceName
                            - resourceType
                            type: object
                          resourceYaml:
                            description: ResourceYaml contains the resource definition
                            properties:
                              disabled:
                                description: Disabled flag
                                type: boolean
                              flavor:
                                description: Flavor of the resource
                                type: string
                              inputs:
                                description: Inputs for the resource
                                type: object
                                x-kubernetes-preserve-unknown-fields: true
                              kind:
                                description: Kind of the resource
                                type: string
                              metadata:
                                additionalProperties:
                                  type: string
                                description: Metadata for the resource
                                type: object
                              spec:
                                description: Spec contains resource-specific configuration
                                type: object
                                x-kubernetes-preserve-unknown-fields: true
                              version:
                                description: Version of the resource
                                type: string
                            required:
                            - disabled
                            - flavor
                            - kind
                            - spec
                            - version
                            type: object
                        required:
                        - name
                        - resourceYaml
                        type: object
                      type: array
                    source:
                      description: Source URL of the module
                      type: string
                  required:
                  - name
                  - source
                  type: object
                minItems: 1
                type: array
              phaseOverrides:
                additionalProperties:
                  description: |-
                    ReleaseTerraformOptions defines release-specific terraform option overrides
                    This extends the template's TerraformOptions with release-specific values
                  properties:
                    forceUnlockLockID:
                      description: |-
                        ForceUnlockLockID provides the lock ID to unlock when template has enableForceUnlock: true
                        This is only used if the template's terraformOptions.enableForceUnlock is true
                        Format: UUID string (e.g., "a1b2c3d4-e5f6-7890-abcd-ef1234567890")
                      type: string
                    lockTimeout:
                      description: LockTimeout override for the template's lock timeout
                        setting
                      type: string
                    parallelism:
                      description: Parallelism override for the template's parallelism
                        setting
                      type: integer
                    refresh:
                      description: Refresh override for the template's refresh setting
                      type: boolean
                  type: object
                description: |-
                  PhaseOverrides allows per-phase override of terraform options from the template
                  Key is the phase name (e.g., "plan", "apply")
                type: object
              project:
                description: Project identifies the project name
                type: string
              releaseTemplateRef:
                description: ReleaseTemplateRef references a ReleaseTemplate resource
                properties:
                  name:
                    description: Name of the ReleaseTemplate
                    type: string
                  namespace:
                    description: Namespace of the ReleaseTemplate
                    type: string
                required:
                - name
                - namespace
                type: object
              targettedResources:
                description: TargettedResources specifies resources to target
                items:
                  description: TargetResource defines a resource to target during
                    terraform operations
                  properties:
                    name:
                      description: Name of the resource
                      type: string
                    type:
                      description: Type of the resource
                      type: string
                  required:
                  - name
                  - type
                  type: object
                type: array
            required:
            - artifactories
            - blueprintAttributes
            - environment
            - logLevelOverride
            - modules
            - project
            - releaseTemplateRef
            type: object
          status:
            description: ReleaseStatus defines the observed state of Release.
            properties:
              approvalPhase:
                description: ApprovalPhase indicates which phase needs approval
                type: string
              approvalRequired:
                description: ApprovalRequired indicates if approval is currently needed
                type: boolean
              completionTime:
                description: CompletionTime is when the release completed
                format: date-time
                type: string
              conditions:
                description: Conditions represent the latest available observations
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              conflictingReleases:
                description: ConflictingReleases lists releases blocking this release
                  due to resource conflicts
                items:
                  type: string
                type: array
              currentPhase:
                description: CurrentPhase indicates which phase is currently executing
                type: string
              duration:
                description: Duration shows the total execution time for completed
                  releases
                type: string
              environmentLocked:
                description: EnvironmentLocked indicates if this release currently
                  holds an environment lock
                type: boolean
              environmentLockedBy:
                description: EnvironmentLockedBy indicates which release currently
                  holds the environment lock
                type: string
              executionID:
                description: |-
                  ExecutionID is a unique identifier for this release execution lifecycle
                  Used for correlating all traces/events for a single release deployment from start to finish
                  The trace ID is deterministically derived from this execution ID
                type: string
              executionStartTime:
                description: ExecutionStartTime is when the release actually started
                  executing (transitioned to Running)
                format: date-time
                type: string
              isFullRelease:
                description: IsFullRelease indicates whether this is a full release
                  (no targeted resources)
                type: boolean
              lockedResources:
                description: LockedResources lists resources currently locked by this
                  release
                items:
                  description: TargetResource defines a resource to target during
                    terraform operations
                  properties:
                    name:
                      description: Name of the resource
                      type: string
                    type:
                      description: Type of the resource
                      type: string
                  required:
                  - name
                  - type
                  type: object
                type: array
              message:
                description: Message provides additional information about the current
                  status
                type: string
              parallelReleases:
                description: ParallelReleases lists other releases running in parallel
                  in same environment
                items:
                  type: string
                type: array
              phase:
                description: Phase represents the current overall phase of the release
                enum:
                - Pending
                - AcquiringLock
                - Running
                - WaitingForApproval
                - Completed
                - Failed
                - Voided
                - Declined
                - Queued
                type: string
              phaseStatuses:
                description: PhaseStatuses tracks the status of each phase
                items:
                  description: PhaseStatus defines the status of an individual phase
                  properties:
                    approvalRequired:
                      description: ApprovalRequired indicates if this phase needs
                        approval
                      type: boolean
                    approvedAt:
                      description: ApprovedAt timestamp when approval was granted
                      format: date-time
                      type: string
                    approvedBy:
                      description: ApprovedBy indicates who approved the phase
                      type: string
                    declineReason:
                      description: DeclineReason provides the reason for decline
                      type: string
                    declinedAt:
                      description: DeclinedAt timestamp when phase was declined
                      format: date-time
                      type: string
                    declinedBy:
                      description: DeclinedBy indicates who declined the phase
                      type: string
                    endTime:
                      description: EndTime when the phase completed
                      format: date-time
                      type: string
                    error:
                      description: Error provides error details
                      type: string
                    exitCode:
                      description: ExitCode of the phase pod container
                      format: int32
                      type: integer
                    name:
                      description: Name of the phase
                      type: string
                    podName:
                      description: PodName associated with this phase
                      type: string
                    startTime:
                      description: StartTime when the phase started
                      format: date-time
                      type: string
                    state:
                      description: State of the phase
                      enum:
                      - Pending
                      - Running
                      - WaitingForApproval
                      - Completed
                      - Failed
                      - Voided
                      - Declined
                      type: string
                  required:
                  - name
                  type: object
                type: array
              queuePosition:
                description: QueuePosition indicates the position in the environment
                  queue (0 means not queued or running)
                minimum: 0
                type: integer
              startTime:
                description: StartTime is when the release was created (includes queue
                  waiting time)
                format: date-time
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
